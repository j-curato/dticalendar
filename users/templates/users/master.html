{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>DTI Caraga Calendar of Events</title>  
        
        <!--datatables server-side-->
        <script src="{% static 'js/jquery-3.7.0.js' %}"></script>
        <script src="{% static 'js/jquery.dataTables.min.js' %}"></script>
        <link rel="stylesheet" type="text/css" href="{% static 'css/jquery.dataTables.min.css' %}">

        <!-- DataTables Buttons Extension CSS and JavaScript -->
        <link rel="stylesheet" type="text/css" href="{% static 'css/buttons.dataTables.min.css' %}">
        <!-- <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script> -->
        <script src="{% static 'js/dataTables.buttons.min.js' %}"></script>
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script> -->
        <script src="{% static 'js/jszip.min.js' %}"></script>
        <!-- <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script> -->
        <script src="{% static 'js/buttons.html5.min.js' %}"></script>
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script> -->
        <script src="{% static 'js/pdfmake.min.js' %}"></script>
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script> -->
        <script src="{% static 'js/vfs_fonts.js' %}"></script>
        <!-- <script src="https://cdn.datatables.net/buttons/2.0.0/js/buttons.print.js"></script> -->
        <script src="{% static 'js/buttons.print.js' %}"></script>
        <!-- <script src="https://printjs-4de6.kxcdn.com/print.min.js"></script> -->
        <script src="{% static 'js/ColReorderWithResize.js' %}"></script>


        <!--CSS Bootstrap-->
        <script src="{% static 'js/popper.min.js' %}"></script>
        <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
        <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap5.3.2.min.css' %}">
        <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script> -->
        <script src="{% static 'js/bootstrap5.3.2.bundle.min.js' %}"></script>
        <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"> -->
        <!-- <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
        <title>Bootstrap Example</title> -->
        <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script> -->

        <!-- <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css"> -->
        <link rel="stylesheet" href="{% static 'css/jquery-ui.css' %}">
        <!-- <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script> -->
        <script src="{% static 'js/jquery-ui.js' %}"></script>
        
    
        <!--vue.js-->
        <script src="{% static 'js/vue.global.js' %}"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script> -->
        <link rel="stylesheet" type="text/css" href="{% static 'css/fixedColumns.dataTables.min.css' %}"/>
        <script type="text/javascript" src="{% static 'js/dataTables.fixedColumns.min.js' %}"></script>


    <style type="text/css">

        .ui-autocomplete-input{
            z-index: 9999 !important;
        }

        /* Apply a higher z-index to the modal dialog */
        .modal-dialog{
            z-index: 1050 !important; /* Adjust this value if necessary */
        }

        /* Apply a higher z-index to the autocomplete suggestions */
        .ui-autocomplete {
            z-index: 9999 !important; /* Should be higher than the modal */
        }

        /*Not Required*/
        .btn{margin-bottom:15px;}
        /*Required*/
        @media (max-width: 576px){.modal-dialog.modal-dialog-slideout {width: 80%}}
        .modal-dialog-slideout {min-height: 30%; margin: 50 auto 0 0 ;background: #fff;}
        .modal.fade .modal-dialog.modal-dialog-slideout {-webkit-transform: translate(-100%,0);transform: translate(-100%,0);}
        .modal.fade.show .modal-dialog.modal-dialog-slideout {-webkit-transform: translate(0,0);transform: translate(0,0);flex-flow: column;}
        .modal-dialog-slideout .modal-content{border: 0;}

        .highlight-offices{
            text-align: center;
            font-size: 11px;
            color:#fff;
            padding: 4px;
            font-family: Verdana, sans-serif;
        }

        .highlight-vacant{
            text-align: center;
           /* background-color: darkgrey;*/
           background-color: transparent !important;
            font-size: 11px;
            color: #fff;
            padding: 4px;
            font-family: Verdana, sans-serif;
            border-radius: 10px;
        } 
        .regional-office,
        .po-adn,
        .po-ads,
        .po-sdn,
        .po-sds,
        .po-pdi
        {
          background-color: rgba(62, 104, 230, 0.741);
          /* border-radius: 10px; */
        }
      
        .multiline {
            white-space: pre-line;  /* Preserve newlines and spaces */
            margin-bottom: 8px;     /* Add space between lines */
            padding: 4px;
        }

        /* Custom tooltip styles */
        .custom-tooltip {
            --bs-tooltip-bg: #000000;
            --bs-tooltip-color: #fff;
        }

      .bold-column {
          color: black;
      }

      .form-switch .form-check-input{
        border-color: #a5a1a1;
      } 

      .dti-cal-container{
        width: 90%; /* Adjust this value as needed */
        max-width: 100%;
        margin: 0 auto; /* Center the container horizontally */
      }

      .form-control-login {
        display: block;
        width: 100%;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: #495057;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        height: 3em; /* Your specified height */
    }

    .form-control-login:focus {
        color: #495057;
        background-color: #fff;
        border-color: #80bdff;
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    @media only screen and (min-width: 768px) {
        .form-control-login, .container-login, .login-button-div, .login-title {
                width: 50%; /* Adjust the width as needed for larger screens */
                margin: auto; /* Center align the input on larger screens */
            }
        } 

    /* Customize border width and color for DataTable */
    .dataTables_wrapper table.dataTable {
        border-collapse: collapse; /* Collapse borders for a cleaner look */
        border: 1px solid #ddd; /* Set border width and color */
    }

    .dataTables_wrapper table.dataTable th,
    .dataTables_wrapper table.dataTable td {
        border: 1px solid #ddd; /* Apply border to table cells */
        padding: 8px; /* Add padding to improve readability */
    }

.dropdown-menu {
    position: absolute;
    background-color: #f9f9f9;
    min-width: 80px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    padding: 12px;
    z-index: 1;
    display: none; /* Hide dropdown menu by default */
}

.ellipsis-icon:hover + .dropdown-menu {
    display: block; /* Show dropdown menu when ellipsis icon is hovered */
}

.dropdown-menu button {
    width: 100%;
    padding: 8px 0;
    text-align: left;
    border: none;
    background: none;
    cursor: pointer;
}


.column-light-green span {
  background-color: #58a1e9;
  /* border-radius: 10px;   */
}

.column-light-yellow span {
    background-color: rgb(231 112 123);
    /* border-radius: 10px; */
}

.column-light-pink span {
    background-color: #4998a9;
    /* border-radius: 10px; */
}

.column-light-orange span {
    background-color:rgb(217 157 93);
    /* border-radius: 10px; */
}

.column-light-purple span {
    background-color: #a55b8b; /* Light Purple */
    /* border-radius: 10px; */
}

.column-light-cyan span {
    background-color: #888c91; /* Light Cyan */
    /* border-radius: 10px; */
}

.column-light-gray span {
    background-color: #8c76b7;    /* border-radius: 10px; */
}

/* Darker backdrop when a second modal is stacked on top of another */
.modal-backdrop + .modal-backdrop {
    opacity: 0.7;
}

/* Searchable dropdown */
.searchable-select-wrapper {
    position: relative;
}
.searchable-select-input:disabled {
    background-color: #e9ecef;
    cursor: not-allowed;
}
.searchable-dropdown-list {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    max-height: 200px;
    overflow-y: auto;
    background: #fff;
    border: 1px solid #ced4da;
    border-top: none;
    border-radius: 0 0 .375rem .375rem;
    z-index: 9999;
    box-shadow: 0 4px 8px rgba(0,0,0,0.12);
}
.searchable-dropdown-item {
    padding: 8px 12px;
    cursor: pointer;
    font-size: 0.875rem;
}
.searchable-dropdown-item:hover,
.searchable-dropdown-item.active {
    background-color: #0d6efd;
    color: #fff;
}
.searchable-dropdown-empty {
    padding: 8px 12px;
    font-size: 0.875rem;
    color: #6c757d;
}
    </style>
        
    </head> 
    
    <body>

    <div class="container dti-cal-container">

    <br>
    <div class="modal fade" id="showOfficeModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-slideout">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Filter Function</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form action="{% url 'load-div-datatbl-html' %}" enctype="multipart/form-data">
                {% csrf_token %}
                  <p>
                    <select id="dtioffice" name="dtioffice" class="form-control form-select">
                        <option value="0">Select Office</option>
                    </select>
                   </p>
                  <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Filter</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  </div>
            </form>
            </div>
          </div>
        </div>
      </div>

      <!--by division modal filter-->
      <div class="modal fade" id="showDtiDivModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-slideout">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Filter Function</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form action="{% url 'load-unit-datatbl-html' %}" enctype="multipart/form-data">
                {% csrf_token %}

                <p>
                  <select id="dtiofficediv" name="dtiofficeparam" class="form-control form-select">
                      <option value="0">Select Office</option>
                  </select>
                </p>

                  <p>
                    <select id="dtidivision" name="dtidivision" class="form-control form-select">
                        <option value="0">Select Division</option>
                        <option value="SDD">SME Development Division (SDD)</option>
                        <option value="IDD">Industry Development Division (IDD)</option>
                        <option value="CPD">Consumer Protection Division (CPD)</option>
                        <option value="FAD">Finance and Admin Division (FAD)</option>
                        <option value="MSSD">Management Support Services Division (MSSD)</option>
                    </select>
                  </p>
                  <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Filter</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  </div>
            </form>
            </div>
          </div>
        </div>
      </div>
      
      
      <div id="{%if txturl == 'events'%}appEvents{%else%}app{% endif %}">

            {% if txturl == 'events' %}
            
          <div class="modal fade" id="specific-event-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-slideout">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalToggleLabel">Event details</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                  <ul class="list-group">
                    <li class="list-group-item" v-for="event in specificEventDetails" :key="event.id">
                      <h5>{[ event.whole_date_start_searchable ]} - {[ event.whole_date_end_searchable ]}</h5>
                      <hr>
                      <p>Activity: {[ event.event_title ]}</p>
                      <p>Description: {[ event.event_desc ]}</p>
                      <p>Participants: {[ event.participants ]}</p>
                      <p>Location: {[ event.event_location ]}</p>
                      <p>Office: {[ event.office ]}</p>
                      <p>Division: {[ event.division_name ]}</p>
                      <p>Unit: {[ event.unit_name ]}</p>
                      <p>Attachment: 
                        <a :href="`/events/download/${event.id}`" download>{[ extractFileName(event.file_attachment) ]}</a>
                      </p>
                    </li>
                  </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>

                <br>
                <div class="row">
                    <div class="col-md-12">
                        <h4>DTI Caraga Calendar of Events</h4>
                    </div>
                </div>
                <br>
            
                <!-- div for the select tag to show filter by function -->
                <div class="row align-items-center">
                    <div class="col-md-6 d-flex align-items-center gap-2">
                        <select id="filterBy" class="form-control form-select" @change="filterEventsDatatbl" style="width:auto">
                            <option value="0">Filter by</option>
                            <option value="office">Office</option>
                            <option value="division">Division</option>
                            <!-- <option value="unit">Unit</option> -->
                        </select>
                        {% now "Y" as current_year %}
                        <select id="filterYear" class="form-control form-select" @change="filterByYear" style="width:auto">
                            <option value="2020" {% if current_year == "2020" %}selected{% endif %}>2020</option>
                            <option value="2021" {% if current_year == "2021" %}selected{% endif %}>2021</option>
                            <option value="2022" {% if current_year == "2022" %}selected{% endif %}>2022</option>
                            <option value="2023" {% if current_year == "2023" %}selected{% endif %}>2023</option>
                            <option value="2024" {% if current_year == "2024" %}selected{% endif %}>2024</option>
                            <option value="2025" {% if current_year == "2025" %}selected{% endif %}>2025</option>
                            <option value="2026" {% if current_year == "2026" %}selected{% endif %}>2026</option>
                            <option value="2027" {% if current_year == "2027" %}selected{% endif %}>2027</option>
                            <option value="2028" {% if current_year == "2028" %}selected{% endif %}>2028</option>
                        </select>
                        <span id="active-filter-label" class="badge rounded-pill text-bg-primary" style="display:none; font-size:0.82rem; white-space:nowrap;"></span>
                    </div>
                </div>
                <br>
            {% endif %}
            
            {% block content %}
            
            {% endblock %}

        </div>

        </div>
        
       {% if txturl == 'events' %}
        <script src="{% static 'js/custom-events-vue.js' %}"></script>
       {% else %}
        <script src="{% static 'js/custom-vue.js' %}"></script>
       {% endif %}
        
    </body>

    <script>

      $( document ).ready(function() {
        const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
        const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))

        // Show active filter label based on URL params
        const urlParams = new URLSearchParams(window.location.search);
        const filterLabel = document.getElementById('active-filter-label');
        if (filterLabel) {
            const officeParam = urlParams.get('dtioffice');
            const divParam = urlParams.get('dtidivision');
            if (officeParam && officeParam !== '0') {
                filterLabel.textContent = 'Office: ' + officeParam;
                filterLabel.style.display = 'inline';
            } else if (divParam && divParam !== '0') {
                filterLabel.textContent = 'Division: ' + divParam;
                filterLabel.style.display = 'inline';
            }
        }

        // Dynamically populate office dropdowns from tbl_offices
        fetch('/offices/api/get-offices-list/')
            .then(function(r) { return r.json(); })
            .then(function(offices) {
                ['dtioffice', 'dtiofficediv'].forEach(function(selectId) {
                    const select = document.getElementById(selectId);
                    if (select) {
                        offices.forEach(function(office) {
                            const option = document.createElement('option');
                            option.value = office.office_initials;
                            option.textContent = office.office_initials + ' - ' + office.office_name;
                            select.appendChild(option);
                        });
                    }
                });
            });
      });

      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
      })

      function openNewTab(url) {
        // Open a new tab/window with the specified URL
        window.open(url, '_blank');
    }

    function dropdownChange(selectElement, rowId) {

      $("#confirm-modal").modal("show");
      $("#confirm-modal-id").text("Please confirm to remove Event ID: " + rowId);
      // Set the ID in the data attribute of the "Confirm" button
      $("#confirm-btn").data("eventId", rowId);

    }

    // Stack second modal's backdrop above the first modal.
    // Use 'shown.bs.modal' (not 'show.bs.modal') so Bootstrap has already
    // added the new backdrop to the DOM before we target it.
    $(document).on('shown.bs.modal', '.modal', function() {
        var openModals = $('.modal.show');
        if (openModals.length > 1) {
            var zBase = 1060 + (openModals.length * 30);
            $(this).css('z-index', zBase + 10);
            $('.modal-backdrop').last().css('z-index', zBase);
        }
    });

    $(document).on('hidden.bs.modal', '.modal', function() {
        $(this).css('z-index', '');
    });

    </script>

</html>